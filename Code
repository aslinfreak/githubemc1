USE [OneC_SPay]
GO
/****** Object:  StoredProcedure [dbo].[usp_GetUploaderFilterData]    Script Date: 28-10-2025 23:51:28 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- ================================================================================================================
-- AUTHOR     : TEAM
-- CREATE DATE: JULY 20, 2020    
-- DESCRIPTION: Added the documentation for the stored procedure
-- ================================================================================================================
ALTER PROCEDURE [dbo].[usp_GetUploaderFilterData]   
(@COMPONENTGROUPID INT=NULL,
@RoleID INT=NULL,
@CountryID int= null
)
/******************************************************************
This User-defined Stored Procedure
used in SPAY  to allow 
faster execution and reduce network traffic.
****************************************************************/
AS
SET NOCOUNT ON
BEGIN
BEGIN TRY


IF(@COMPONENTGROUPID=5)
BEGIN
	SELECT @RoleID=7 WHERE @RoleID in (7,9) 
	Select @RoleID=3 where @RoleID in (3,8)
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined2 =@RoleID or CUserDefined3=@RoleID) 
	group by CUserDefined1,CDescription
END

ELSE IF(@COMPONENTGROUPID=2 and @CountryID in (2,18,19)) 
BEGIN

	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
	WHERE CParentRef=8 AND CCodeId=2 AND RowStatus=1 
	and (CUserDefined1=1 or CUserDefined2 =1 or CUserDefined3=1) 
	and CUserDefined3 not in  ('20')
	group by CUserDefined1,CDescription
END

Else if ((@COMPONENTGROUPID in (1,2,3) and @CountryID not in (20)) and @RoleID in (1,18))
BEGIN
	SELECT @RoleID=1 WHERE @RoleID =18

	IF(@COMPONENTGROUPID=2)
	BEGIN
		SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
		WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
		and CUserDefined4=18
		group by CUserDefined1,CDescription
	END
END

Else if (@COMPONENTGROUPID in (4,98,100))---VNM NSA
BEGIN
	SELECT @RoleID=1 WHERE @RoleID =6
END

ELSE IF(@COMPONENTGROUPID in (7,8,9,10,11))
BEGIN
	SELECT @RoleID=10 WHERE @RoleID =3
END

ELSE IF(@COMPONENTGROUPID in (12))
BEGIN
	SELECT @RoleID=12 WHERE @RoleID =6
END

ELSE IF(@COMPONENTGROUPID in (43,44))
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined1=@RoleID or CUserDefined2 =@RoleID or CUserDefined3=@RoleID) 
	group by CUserDefined1,CDescription
END

ELSE IF(@COMPONENTGROUPID=0)
BEGIN
	if (@Roleid=3 or @Roleid=2 or @Roleid=1)
	BEGIN
		SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
		WHERE CParentRef=8 AND CCodeId=5 AND RowStatus=1 
		and (CUserDefined2=@Roleid or CUserDefined3=@Roleid or Cuserdefined4=@Roleid) 
		and CParentId=3
	END
	Else if (@Roleid=16)
	BEGIN
		SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
		WHERE CParentRef=8 AND RowStatus=1 
		and (CUserDefined2=@RoleID and CUserDefined3=@RoleID)
	END
	ELSE if (@Roleid in(7,9,8))
	BEGIN
		SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
		WHERE CParentRef=8 AND CCodeId=5 AND RowStatus=1 
		and (CUserDefined4=7)
	END
END

ELSE if (@Roleid in(7,9))
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
	WHERE CParentRef=8 AND CCodeId=5 AND RowStatus=1 
	and (CUserDefined4=7)
END

ELSE if ((@Roleid in(19,20,21,3)) and @CountryID=3)
BEGIN
	if (@COMPONENTGROUPID in(39,22)) 
	BEGIN
		SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
		WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
		and (CUserDefined1=@RoleID or CUserDefined2 =@RoleID or CUserDefined3=@RoleID 
		or CUserDefined4=@RoleID) and CUserDefined4=@CountryID
		group by CUserDefined1,CDescription
	END 
	ELSE
	BEGIN
		SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
		WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
		and (CUserDefined1=@RoleID OR CUserDefined2=@RoleID or CUserDefined3=@RoleID)
		group by CUserDefined1,CDescription
	END
END

ELSE if ((@Roleid=19 OR @Roleid=20 OR @Roleid=21 or @Roleid=3) and @CountryID<>3 
and (@COMPONENTGROUPID=2 and @CountryID <>20))
BEGIN

	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 and Cuserdefined5=7
	and (CUserDefined1=@RoleID OR CUserDefined2=@RoleID or CUserDefined3=@RoleID 
	or CUserDefined4=@RoleID)
	group by CUserDefined1,CDescription

END

ELSE if ((@COMPONENTGROUPID=2 and @CountryID=20 and (@Roleid=3 or @Roleid=1)))
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 and Cuserdefined5=20
	and (CUserDefined1=@RoleID OR CUserDefined2=@RoleID or CUserDefined3=@RoleID)
	group by CUserDefined1,CDescription

END

ELSE if (@COMPONENTGROUPID=17 )
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined2=@RoleID or CUserDefined3 =@RoleID)
	group by CUserDefined1,CDescription
END

ELSE if (@COMPONENTGROUPID=18 and @CountryID <>2)
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined1=@RoleID  or CUserDefined2=@RoleID or CUserDefined3 =@RoleID 
	or CUserDefined4=@RoleID)and Cuserdefined5 is not null
	group by CUserDefined1,CDescription
	
END

ELSE if (@COMPONENTGROUPID=18 and @CountryID =2)
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined2=@RoleID or CUserDefined3 =@RoleID)and Cuserdefined5 is null
	group by CUserDefined1,CDescription
END

ELSE if (@COMPONENTGROUPID=25 or @COMPONENTGROUPID=42 or @COMPONENTGROUPID=26 
or @COMPONENTGROUPID=27  )
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined1=@RoleID or CUserDefined2 =@RoleID)
	and Cuserdefined3=@CountryID
	group by CUserDefined1,CDescription
END

ELSE IF(@COMPONENTGROUPID=89 and @CountryID =20) 
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined1=@RoleID or CUserDefined3 =@RoleID ) and CUserDefined4=20
	group by CUserDefined1,CDescription
END

ELSE IF(@COMPONENTGROUPID=48 and @CountryID = 16) 
BEGIN
SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK)
WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined1=@RoleID or CUserDefined2 =@RoleID or CUserDefined3=@RoleID) 
	and CUserDefined4=16
	group by CUserDefined1,CDescription
END

ELSE if ((@Roleid=3 OR @Roleid=20 ) AND @COMPONENTGROUPID =22 AND @CountryID NOT IN (8,9))
BEGIN
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined1=@RoleID OR CUserDefined2=@RoleID or CUserDefined3=@RoleID)
	group by CUserDefined1,CDescription

END
ELSE if (@COMPONENTGROUPID IN (22,101,39)  AND @CountryID IN(8,9))
BEGIN
	IF(@RoleID IN (3,20,6))
	BEGIN
		Select CUserDefined1,CDescription  From MasterCodes 
		where CParentRef=8 and CCodeId = @COMPONENTGROUPID and CUserDefined5 is not null and RowStatus =1
		group by CUserDefined1,CDescription
	END
	ELSE IF(@RoleID = 19)
	BEGIN
		Select CUserDefined1,CDescription  From MasterCodes 
		where CParentRef=8 and CCodeId = @COMPONENTGROUPID and CUserDefined5=7 and RowStatus =1
		group by CUserDefined1,CDescription
	END
	

END

ELSE if ((@Roleid=19 OR @Roleid=20 or @Roleid=3) and @COMPONENTGROUPID=39 AND @CountryID NOT IN (8,9))
BEGIN

	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 and Cuserdefined5=7
	and (CUserDefined1=@RoleID OR CUserDefined2=@RoleID or CUserDefined3=@RoleID)
	group by CUserDefined1,CDescription

END
ELSE if (@COMPONENTGROUPID in(102,103,104,105) and @Roleid in(6,23))
BEGIN
SELECT @RoleID=6 WHERE @RoleID =23
END
	SELECT CUserDefined1,CDescription FROM MasterCodes WITH (NOLOCK) 
	WHERE CParentRef=8 AND CCodeId=@COMPONENTGROUPID AND RowStatus=1 
	and (CUserDefined1=@RoleID or CUserDefined2 =@RoleID or CUserDefined3=@RoleID) 
	group by CUserDefined1,CDescription




 END TRY
 BEGIN CATCH
 SELECT @@ERROR
 END CATCH 
END
/******************************************************************
This User-defined Stored Procedure
used in SPAY  to allow 
faster execution and reduce network traffic.
****************************************************************/
