IF(@componentGroupId=5)
	BEGIN

	  SELECT trt.PK_TRTSpecialInputsID, trt.Fk_ComponentTypeID, trt.FK_ComponentID,
	    trt.AssociateID, trt.ProjectID, trt.Fk_CurrencyID, trt.Amount, trt.InvoiceNumber,
		trt.RewardName, trt.ApproverID, trt.Department, trt.vertical, trt.Funded,
		trt.uploaderID, trt.SpecialCaseReason, trt.IsApprovalAttached, trt.InputRemarks,
		trt.FileUploadID, trt.FK_RejectedRoleID, trt.RejectedBy, trt.RejectionReason,
		trt.OtherMailUploadID, trt.[Status], trt.ApprovedBy, trt.ApprovedDate,
	    trt.ApproverRoleID, ep.CreatedBy as EPCreatedby, trt.CreatedBy,@Currentdate as EPCreatedDAte,
		trt.Createddate,		trt.ModifiedBy, trt.ModifiedDate, trt.Remarks, trt.Rowstatus,
		ep.RejectionReason AS EPRejectionReason,Ep.Approve_Reject,
		COALESCE((CASE WHEN (ISNULL(ep.RejectionReason,'') = '' AND ep.approve_Reject = 'Reject') 
		THEN 'Rejection reason is mandatory,' ELSE '' END),'')
		+
		COALESCE((CASE WHEN ISNULL(trt.PK_TRTSpecialInputsID,'') = '' 
		THEN 'Please upload the valid Unique id' ELSE '' END),'') AS ExceptionRemarks, 		
		0 AS MailStatus ,ccm.Pk_ComponentCountryMappingID AS Pk_ComponentCountryMappingID
		INTO #Exception_TRT
		FROM STG.ExceptiontovalidAllowance ep WITH (NOLOCK) 
		INNER JOIN pr.trtspecialinputs trt WITH (NOLOCK) ON ep.UniqueID = trt.PK_TRTSpecialInputsID 
		INNER JOIN ComponentCountryMapping ccm WITH (NOLOCK) ON ccm.Fk_ComponentID = trt.FK_ComponentID 
		WHERE ep.RowStatus = 1 AND trt.RowStatus = 1 AND ccm.Rowstatus = 1 and trt.Status in (1,3,4,8,9,13,14,12)

	  --------- inserting data------------------
	  INSERT INTO pr.trtspecialinputs_log (PK_TRTSpecialInputsID, Fk_ComponentTypeID,
	    FK_ComponentID,AssociateID, ProjectID, Fk_CurrencyID, Amount, InvoiceNumber,
		RewardName, ApproverID, Department, vertical, Funded, uploaderID,
	    SpecialCaseReason, IsApprovalAttached, InputRemarks, FileUploadID,
		FK_RejectedRoleID,RejectedBy, RejectionReason, OtherMailUploadID,
		[Status], ApprovedBy, ApporvedDate, ApproverRoleID, LogCreatedBy, CreatedBy,
	    LogCreateddate, Createddate, ModifiedBy, ModifiedDate, Remarks, Rowstatus)
	  SELECT trt.PK_TRTSpecialInputsID, trt.Fk_ComponentTypeID, trt.FK_ComponentID,
	    trt.AssociateID, trt.ProjectID, trt.Fk_CurrencyID, trt.Amount, trt.InvoiceNumber,
		trt.RewardName, trt.ApproverID, trt.Department, trt.vertical, trt.Funded,
		trt.uploaderID, trt.SpecialCaseReason, trt.IsApprovalAttached, trt.InputRemarks,
		trt.FileUploadID, trt.FK_RejectedRoleID, trt.RejectedBy, trt.RejectionReason,
		trt.OtherMailUploadID, trt.[Status], trt.ApprovedBy, trt.ApprovedDate,
	    trt.ApproverRoleID, trt.EPCreatedby, trt.CreatedBy,@Currentdate, trt.Createddate,
		trt.ModifiedBy, trt.ModifiedDate, trt.Remarks, trt.Rowstatus
	  FROM #Exception_TRT trt	

		DELETE FROM #Exception_TRT WHERE ISNULL(ExceptionRemarks,'')<>''	
	
	   UPDATE ESTP 
		  SET ESTP.Status = CASE WHEN STP.Approve_Reject = 'Approved' THEN IIF( @CreatedRole = 8,13,14) ELSE IIF( @CreatedRole = 8,9,8) END,
			ESTP.ModifiedBy = STP.EPCreatedBy,
			ESTP.ModifiedDate = @Currentdate, 			
			ESTP.Remarks = CASE WHEN STP.Approve_Reject = 'Approved' THEN 'Bulk Approve' ELSE 'Bulk Reject' END, 
			ESTP.RejectionReason = STP.EPRejectionReason, 
			ESTP.ApprovedBy = CASE WHEN STP.Approve_Reject = 'Approved' THEN STP.EPCreatedBy ELSE ESTP.ApprovedBy END, 
			ESTP.ApprovedDate = CASE WHEN STP.Approve_Reject = 'Approved' THEN @Currentdate ELSE ESTP.ApprovedDate END, 
			ESTP.ApproverRoleID = CASE WHEN STP.Approve_Reject = 'Approved'  THEN IIF( @CreatedRole = 8,8,3) ELSE ESTP.ApproverRoleID END,
			ESTP.RejectedBy = CASE WHEN STP.Approve_Reject = 'Reject' THEN STP.EPCreatedBy ELSE ESTP.RejectedBy END, 
			ESTP.FK_RejectedRoleID = CASE WHEN STP.Approve_Reject = 'Reject' THEN IIF( @CreatedRole = 8,8,3)  END
		  FROM PR.TRTSpecialInputs ESTP WITH (NOLOCK) 
		  INNER JOIN #Exception_TRT STP WITH (NOLOCK) 
			ON ESTP.PK_TRTSpecialInputsID = STP.PK_TRTSpecialInputsID 
		  WHERE STP.Approve_Reject IN ('Approved', 'Reject')
	 
	  DROP TABLE #Exception_TRT

	END
