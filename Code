USE [OneC_SPay]
GO
Declare
@ComponentGrpID INT =5,  
@COMPONENTID INT=8,  
@MONTH INT=1,  
@QUARTER INT=0,  
@YEAR INT='2026',  
@REPORTID INT=1,  
@LOGINID INT='2084470',  
@RoleID int=2,  
@CountryID int=1,  
@Componentgrp varchar(500)=null  
 
----------------- declaring variable-----------  
Declare @RolePriority int  
  
   Declare @Startmonth int,@EndMonth int  
  SElect @Startmonth= CASE WHEN @QUARTER=1 then @QUARTER when @QUARTER=2 then @QUARTER+2  
  when @QUARTER=3 then @QUARTER+4   
  when @QUARTER=4 then @QUARTER+6 end  
 Select @EndMonth=@Startmonth+2  
  
-------Report is generated based on report id--------------  
IF (@Reportid=1)   
BEGIN  
EXEC [dbo].[usp_GetFinalValidDataReports]  @ComponentGrpID,@COMPONENTID,@MONTH,@YEAR,  
@LOGINID,@RoleID,@CountryId,@Componentgrp  
END  
-------Report is generated based on report id--------------  
IF (@REPORTID=2)  
BEGIN  
EXEC [dbo].[usp_GetExceptionReports]   @ComponentGrpID,@COMPONENTID,@MONTH,@YEAR,@LOGINID,@RoleID,@QUARTER,@CountryId  
END  
-------Report is generated based on report id--------------  
IF (@REPORTID=3)  
BEGIN  
EXEC [dbo].[usp_GetRejected_DeletedReports]   @ComponentGrpID,@COMPONENTID,@MONTH,@YEAR,@LOGINID,@RoleID,@QUARTER  
END  
-------Report is generated based on report id--------------  
IF (@REPORTID=4)  
BEGIN  
EXEC [dbo].[usp_GetMyPayPushReports]   @ComponentGrpID,@COMPONENTID,@MONTH,@YEAR,@LOGINID,@RoleID  
END  
-------Report is generated based on report id--------------  
if(@REPORTID=5)  
BEGIN  
EXEC [dbo].[usp_GetPaymentStatusReports]  @ComponentGrpID,@COMPONENTID,@MONTH,@YEAR,@LOGINID,@RoleID,@CountryId  
END  
-------Report is generated based on report id--------------  
if(@REPORTID=6)  
BEGIn  
EXEC [dbo].[usp_GetReversalFinalDataReports]   @ComponentGrpID,@COMPONENTID,@MONTH,@YEAR,@LOGINID,@CountryId  
END  
-------Report is generated based on report id--------------  
if(@REPORTID=7)  
BEGIn  
EXEC [dbo].[usp_StopPaymentReport] @ComponentGrpID,@COMPONENTID,@MONTH,@YEAR,@LOGINID,@RoleID,@CountryId  
END  
-------Report is generated based on report id--------------  
if(@ReportID=8)  
BEGIN  
EXEC [dbo].[usp_DataCurrencyTemplateReport] @CountryId,1  
END  
-------Report is generated based on report id--------------  
if(@REPORTID=9)  
BEGIN  
SElect @Startmonth= CASE WHEN  @QUARTER=2 then 1 when @QUARTER=3 then @QUARTER+1 when @QUARTER=4 then @QUARTER+3   
when @QUARTER=5 then @QUARTER+5 end  
Select @EndMonth=@Startmonth+2  
  
Create table #RoleTable(Fk_RoleID int)  
  
INSERT INTO #RoleTable(Fk_RoleID)  
select CRM.FK_RoleID from Userrolemapping URM with (nolock)  
INNER JOIN ComponentRoleMapping CRM with (nolock) on URM.FK_ComponentRoleID=CRM.PK_ComponentRoleID   
and URM.RowStatus=1  
INNER JOIN COMPONENTCOUNTRYMAPPING CCM WITH(NOLOCK)   
ON CCM.PK_COMPONENTCOUNTRYMAPPINGID=CRM.FK_COMPONENTCOUNTRYMAPPINGID  
INNER JOIN COMPONENTMASTER CM WITH(NOLOCK) ON CM.PK_COMPONENTID=CCM.FK_COMPONENTID  
 where associateid=@LOGINID and CM.RowStatus=1 and CRM.RowStatus=1 and CM.PK_ComponentId=@COMPONENTID   
  
  select @RolePriority=0 from #RoleTable where Fk_RoleID not in (8,3) and Fk_Roleid in (1,7,9)   
  select @RolePriority =1 from #RoleTable where Fk_RoleID in (8,3)   
  DROP TABLE #RoleTable  
------------------ Check quater------------  
if(@QUARTER =1)   
BEGIN  
SElect @Startmonth= CASE WHEN @QUARTER=1 then @QUARTER end  
Select @EndMonth=12  
END  
--------------- Check RolePriority-------------  
 if (@RolePriority=0)  
  BEGIN  
  SELECT PCBA.AssociateID,ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
  +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'')  
  AS AssociateName,  
  Level,isnull(BUProposedCBAAmount,'') BUProposedCBAAmount,  
  isnull(PreviousCBAAmountProposed,'') PreviousCBAAmountProposed,  
  isnull(Amount,'') FinalCBAAmount,  
  isnull(MC.CDescription,'') SpecialCaseReason,isnull(PCBA.CreatedBy, '' )  TalentManagerID,  
  isnull(PCBA.InputRemarks,'') InputRemarks,  
  isnull(MC_A.Cdescription,'') AS Status   
  FROM PR.CognizantBusinessAllowance PCBA WITH (NOLOCK)  
  LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK) ON   
  CONVERT(VARCHAR,AD.Associate_ID)=CONVERT(VARCHAR,PCBA.AssociateID)  
  LEFT OUTER JOIN mastercodes MC on MC.CParentref=2 and MC.CUserdefined1='6' and MC.Rowstatus=1  
  and MC.CCodeid=PCBA.SpecialCaseReason  
  LEFT Outer Join MasterCodes MC_A on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId and MC_A.RowStatus=1   
  and MC_A.Cuserdefined1='PR'  
  WHERE PCBA.Status =1 AND PCBA.RowStatus=1 AND (month(PCBA.createddate) between @Startmonth and @EndMonth) AND  
  year(PCBA.CreatedDate)=@year and PCBA.CreatedBy=@LOGINID  
  END  
  ELSE   
  BEGIN  
    SELECT PCBA.PK_CognizantBusinessAllowanceID UniqueID, PCBA.AssociateID,  
 ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
 ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
  Level,isnull(BUProposedCBAAmount,'') BUProposedCBAAmount,  
  isnull(PreviousCBAAmountProposed,'') PreviousCBAAmountProposed,  
  isnull(Amount,'') FinalCBAAmount,  
  isnull(MC.CDescription,'') SpecialCaseReason,isnull(PCBA.CreatedBy, '' )  TalentManagerID,  
  isnull(PCBA.InputRemarks,'')   
  InputRemarks, isnull(MC_A.Cdescription,'') AS Status   
  FROM PR.CognizantBusinessAllowance PCBA WITH (NOLOCK)  
  LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK) ON CONVERT(  
  VARCHAR,AD.Associate_ID)=CONVERT(VARCHAR,PCBA.AssociateID)  
  LEFT OUTER JOIN mastercodes MC on MC.CParentref=2 and MC.CUserdefined1='6' and MC.Rowstatus=1   
  and MC.CCodeid=PCBA.SpecialCaseReason  
  LEFT Outer Join MasterCodes MC_A on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId and MC_A.RowStatus=1   
  and MC_A.Cuserdefined1='PR'  
  WHERE PCBA.Status =1 AND PCBA.RowStatus=1 AND (month(PCBA.createddate) between @Startmonth and @EndMonth) AND   
  year(PCBA.CreatedDate)=@year   
  END  
END  
--------------- Check ReportID-------------  
if(@REPORTID=10)   
BEGIN  
  
EXEC [dbo].[usp_ApprovedDataReport] @ComponentGrpID,@COMPONENTID,@MONTH,@YEAR,@LOGINID,@RoleID,@QUARTER,@CountryId  
   
END  
if(@REPORTID=11)  
BEGIN  
--------------- Check RolePriority-------------  
if(@ROLEID not in (6,10))  
BEGIN  
  
--CIS Night Shift Allowance  
if(@COMPONENTID =6)     
BEGIN  
          SELECT PCBA.PK_ShiftTimePayoutID UniqueID, CM.ComponentName,PCBA.AssociateID,ISNULL(LTRIM(RTRIM(  
    AD.Associate_FirstName)),'')+' '+ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    NSADate,PB.HCMSchedule,SwipeInTime, SwipeOutTime,  
    PCBA.ProjectID,PCBA.Amount , PB.TotalEligibleHours TotalMinutes ,Grade,SetID,  
    isnull(PCBA.CreatedBy, '' )  CreatedBy,Case when isnull(PCBA.Modifieddate,'')<>'' then convert(varchar,  
    PCBA.Modifieddate,107) else Convert(varchar,PCBA.Createddate,107) end UploadedDate,   
    isnull(MC_A.Cdescription,'')  Status,   
    TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,  
    TopUpInTime_3,   
    TopUpOutTime_3, TopUpReason_3,  
    TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5, TopUpOutTime_5, TopUpReason_5,  
    TopUpInTime_6,   
    TopUpOutTime_6, TopUpReason_6  
    FROM PR.ShiftTimePayout PCBA WITH (NOLOCK) INNER JOIN PR.CIS_NSA PB WITH(NOLOCK) ON   
    PCBA.AssociateID = PB.AssociateID AND PCBA.NSADate = PB.Date AND PCBA.ProjectId = PB.ProjectID AND   
    PCBA.Fk_ComponentID = PB.Fk_ComponentID  
    INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID   
    and CM.RowStatus = 1  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK) ON   
    CONVERT(VARCHAR,AD.Associate_ID)=CONVERT(VARCHAR,PCBA.AssociateID)   
     LEFT OUTER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId and   
     MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
    WHERE (PCBA.Status IN (1,5,15,16,14) AND PCBA.RowStatus=1)  AND (((month(PCBA.CreatedDate)=@month) AND   
    year(PCBA.CreatedDate)=@year)  OR  
     ((month(PCBA.CreatedDate)=@month) AND year(PCBA.CreatedDate)=@year)) and PB.Fk_ComponentID=6  
END  
  
--BPS Night Shift Allowance   
else if(@ComponentGrpID =10)   
BEGIN    
    SELECT PCBA.PK_BPSNSAId UniqueID, CM.ComponentName,PCBA.AssociateID,ISNULL(LTRIM(RTRIM  
 (AD.Associate_FirstName)),'')+' '+ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
 NSADate,PCBA.HCMSchedule,SwipeInTime, SwipeOutTime,  
 PCBA.ProjectID,PCBA.Amount RoundAmount, ROUND(PCBA.RoughAmount,2) Amount, PB.TotalEligibleHours TotalMinutes ,  
 Grade,SetID,  
 isnull(PCBA.CreatedBy, '' )  CreatedBy,Case when isnull(PCBA.Modifieddate,'')<>''   
 then convert(varchar,PCBA.Modifieddate,107)   
 else Convert(varchar,PCBA.Createddate,107) end UploadedDate, isnull(MC_A.Cdescription,'')  Status,   
 PCBA.MonthAmount,PCBA.MonthlyWorkedDays,  
 TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,   
 TopUpInTime_3, TopUpOutTime_3,TopUpReason_3,  
 TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5, TopUpOutTime_5, TopUpReason_5,   
 TopUpInTime_6, TopUpOutTime_6,TopUpReason_6  
 FROM PR.BPSNSA PCBA WITH (NOLOCK) INNER JOIN PR.BPS_NSA PB WITH(NOLOCK) ON PCBA.AssociateID = PB.AssociateID AND   
 PCBA.NSADate = PB.Date AND PCBA.ProjectId = PB.ProjectID  
 INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PB.Fk_ComponentID and CM.RowStatus = 1  
 LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK) ON CONVERT(  
 VARCHAR,AD.Associate_ID)=CONVERT(VARCHAR,PCBA.AssociateID)   
 LEFT OUTER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId and   
 MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
 WHERE (PCBA.Status IN (1,5,15,16,14) AND PCBA.RowStatus=1)  AND (((month(PCBA.CreatedDate)=@month) AND   
 year(PCBA.CreatedDate)=@year)  OR  ((month(PCBA.CreatedDate)=@month) AND year(PCBA.CreatedDate)=@year))  
 and PB.Fk_ComponentID=39  
END  
else if(@COMPONENTID =52)   
BEGIN    
     SELECT PCBA.PK_ITShiftAllowanceID UniqueID, CM.ComponentName,PCBA.AssociateID,ISNULL(LTRIM(RTRIM(  
    AD.Associate_FirstName)),'')+' '+ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    NSADate,PB.HCMSchedule,SwipeInTime, SwipeOutTime,  
    PCBA.ProjectID,PCBA.Amount , PB.TotalEligibleHours TotalMinutes ,Grade,SetID,  
    isnull(PCBA.CreatedBy, '' )  CreatedBy,Case when isnull(PCBA.Modifieddate,'')<>'' then convert(varchar,  
    PCBA.Modifieddate,107) else Convert(varchar,PCBA.Createddate,107) end UploadedDate,   
    isnull(MC_A.Cdescription,'')  Status,   
    TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,  
    TopUpInTime_3,   
    TopUpOutTime_3, TopUpReason_3,  
    TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5, TopUpOutTime_5, TopUpReason_5,  
    TopUpInTime_6,   
    TopUpOutTime_6, TopUpReason_6  
    FROM PR.ITShiftAllowance PCBA WITH (NOLOCK) INNER JOIN PR.IT_NSA PB WITH(NOLOCK) ON   
    PCBA.AssociateID = PB.AssociateID AND PCBA.NSADate = PB.Date AND PCBA.ProjectId = PB.ProjectID AND   
    PCBA.Fk_ComponentID = PB.Fk_ComponentID  
    INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID   
    and CM.RowStatus = 1  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK) ON   
    CONVERT(VARCHAR,AD.Associate_ID)=CONVERT(VARCHAR,PCBA.AssociateID)   
     LEFT OUTER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId and   
     MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
    WHERE (PCBA.Status IN (1,5,15,16,14) AND PCBA.RowStatus=1)  AND (((month(PCBA.CreatedDate)=@month) AND   
    year(PCBA.CreatedDate)=@year)  OR  
     ((month(PCBA.CreatedDate)=@month) AND year(PCBA.CreatedDate)=@year)) and PB.Fk_ComponentID=52  
END  
else if(@COMPONENTID =172)   
BEGIN    
   SELECT PCBA.PK_ADMShiftAllowanceID UniqueID, CM.ComponentName,PCBA.AssociateID,ISNULL(LTRIM(RTRIM(  
    AD.Associate_FirstName)),'')+' '+ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    NSADate,PB.HCMSchedule,SwipeInTime, SwipeOutTime,  
    PCBA.ProjectID,PCBA.Amount , PB.TotalEligibleHours TotalMinutes ,PCBA.Grade,SetID,  
    isnull(PCBA.CreatedBy, '' )  CreatedBy,Case when isnull(PCBA.Modifieddate,'')<>'' then convert(varchar,  
    PCBA.Modifieddate,107) else Convert(varchar,PCBA.Createddate,107) end UploadedDate,   
    isnull(MC_A.Cdescription,'')  Status,   
    TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,  
    TopUpInTime_3,   
    TopUpOutTime_3, TopUpReason_3,  
    TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5, TopUpOutTime_5, TopUpReason_5,  
    TopUpInTime_6,   
    TopUpOutTime_6, TopUpReason_6  
    FROM PR.ADMShiftAllowance PCBA WITH (NOLOCK) INNER JOIN PR.ADM_NSA PB WITH(NOLOCK) ON   
    PCBA.AssociateID = PB.AssociateID AND PCBA.NSADate = PB.Date AND PCBA.ProjectId = PB.ProjectID AND   
    PCBA.Fk_ComponentID = PB.Fk_ComponentID  
    INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID   
    and CM.RowStatus = 1  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK) ON   
    CONVERT(VARCHAR,AD.Associate_ID)=CONVERT(VARCHAR,PCBA.AssociateID)   
     LEFT OUTER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId and   
     MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
    WHERE (PCBA.Status IN (1,5,15,16,14) AND PCBA.RowStatus=1)  AND (((month(PCBA.CreatedDate)=@month) AND   
    year(PCBA.CreatedDate)=@year)  OR  
     ((month(PCBA.CreatedDate)=@month) AND year(PCBA.CreatedDate)=@year)) and PB.Fk_ComponentID=172  
END  
END  
END  
  
if(@REPORTID=17)   
BEGIN  
if(@ROLEID not in (6,10))  
BEGIN  
--CIS NSA Allowance  
 if(@COMPONENTID in (6))   
 BEGIN  
            SELECT PCBA.PK_CISNSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
   ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
   ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
     Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID, 300 Amount,TotalEligibleHours TotalMinutes,  
     (CASE WHEN Status=0 THEN 'Available for Action' WHEN Status=1 THEN 'Sent to Valid'   
     WHEN Status=2 THEN 'Deleted'   
      WHEN Status=3 THEN 'Rejected'  
      WHEN Status=6 THEN 'Trutime Topup Available' WHEN Status=7  
   THEN 'Already sent to valid under another project ID'   
   WHEN Status=8 THEN 'Sent to Exception by Uploader' END) AS Status ,PCBA.CreatedDate,  
   PCBA.ModifiedBy,PCBA.ModifiedDate,  
     TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,   
     TopUpInTime_3, TopUpOutTime_3, TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4,   
     TopUpInTime_5, TopUpOutTime_5, TopUpReason_5, TopUpInTime_6, TopUpOutTime_6, TopUpReason_6  
     FROM PR.CIS_NSA PCBA WITH(NOLOCK)   
     INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID   
     and CM.RowStatus = 1  
      LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
   on AD.Associate_ID = PCBA.AssociateID   
     WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
     and PCBA.Fk_ComponentID=6  
 END  
   
 --NSA  
 else if(@ComponentGrpID in (10))   
 BEGIN    
     SELECT PCBA.PK_BPS_NSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
     ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
     ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
     Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID,Amount,TotalEligibleHours TotalMinutes,  
     (CASE WHEN Status=0 THEN 'Available for Action' WHEN Status=1 THEN 'Sent to Valid'  WHEN Status=2   
     THEN 'Deleted'   
     WHEN Status=3 THEN 'Rejected'  
      WHEN Status=6 THEN 'Trutime Topup Available' WHEN Status=7  
   THEN 'Already sent to valid under another project ID'   
   WHEN Status=8 THEN 'Sent to Exception by Uploader' END) AS Status ,PCBA.CreatedDate,PCBA.ModifiedBy,  
   PCBA.ModifiedDate,  
     TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,  
     TopUpInTime_3,   
     TopUpOutTime_3, TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5,  
     TopUpOutTime_5,   
     TopUpReason_5, TopUpInTime_6, TopUpOutTime_6, TopUpReason_6  
     FROM PR.BPS_NSA PCBA WITH(NOLOCK)  
     INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID   
     and CM.RowStatus = 1  
     LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
     ON AD.Associate_ID = PCBA.AssociateID   
     WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
     and PCBA.Fk_ComponentID=39  
 END  
  
 --ADM nsa Allowance  
 else if(@COMPONENTID in (172))   
 BEGIN  
        SELECT PCBA.Pk_ADMNSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
  ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
  ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
  Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID, 300 Amount,TotalEligibleHours TotalMinutes,  
  (CASE WHEN Status=0 THEN 'Available for Action' WHEN Status=1 THEN 'Sent to Valid'  WHEN Status=2  
  THEN 'Deleted'   
  WHEN Status=3 THEN 'Rejected'  
  WHEN Status=6 THEN 'Trutime Topup Available' WHEN Status=7  
  THEN 'Already sent to valid under another project ID'   
  WHEN Status=8 THEN 'Sent to Exception by Uploader' END) AS Status ,PCBA.CreatedDate,PCBA.ModifiedBy,  
  PCBA.ModifiedDate,  
  TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,  
  TopUpInTime_3,   
  TopUpOutTime_3, TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5, TopUpOutTime_5,   
  TopUpReason_5, TopUpInTime_6, TopUpOutTime_6, TopUpReason_6  
  FROM PR.ADM_NSA PCBA WITH(NOLOCK)   
  INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID  
  and CM.RowStatus = 1  
  LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
  ON AD.Associate_ID = PCBA.AssociateID   
  WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
  and PCBA.Fk_ComponentID=172  
 END  
  
  --IT NSA Allowance  
 else if(@COMPONENTID in (52))   
 BEGIN  
            SELECT PCBA.PK_ITNSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
   ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
   ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
     Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID, 300 Amount,TotalEligibleHours TotalMinutes,  
     (CASE WHEN Status=0 THEN 'Available for Action' WHEN Status=1 THEN 'Sent to Valid'  WHEN Status=2   
     THEN 'Deleted'   
      WHEN Status=3 THEN 'Rejected'  
      WHEN Status=6 THEN 'Trutime Topup Available' WHEN Status=7  
   THEN 'Already sent to valid under another project ID'   
   WHEN Status=8 THEN 'Sent to Exception by Uploader' END) AS Status ,PCBA.CreatedDate,PCBA.ModifiedBy,  
   PCBA.ModifiedDate,  
     TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,   
     TopUpInTime_3,TopUpOutTime_3, TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4,TopUpInTime_5,  
     TopUpOutTime_5, TopUpReason_5,TopUpInTime_6, TopUpOutTime_6, TopUpReason_6  
     FROM PR.IT_NSA PCBA WITH(NOLOCK)   
     INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID  
     and CM.RowStatus = 1  
     LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
     on AD.Associate_ID = PCBA.AssociateID   
     WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
     and PCBA.Fk_ComponentID=52  
 END  
  
 ---VNM NSA  
 else if(@COMPONENTID =175)  
 BEGIN  
            SELECT PCBA.Pk_VNMNSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
   ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
   ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
     Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID, 300 Amount,TotalEligibleHours TotalMinutes,  
     (CASE WHEN Status=0 THEN 'Available for Action' WHEN Status=1 THEN 'Sent to Valid'    
     WHEN Status=2 THEN 'Deleted'   
      WHEN Status=3 THEN 'Rejected'  
      WHEN Status=6 THEN 'Trutime Topup Available' WHEN Status=7   
   THEN 'Already sent to valid under another project ID'   
   WHEN Status=8 THEN 'Sent to Exception by Uploader' END) AS Status ,PCBA.CreatedDate,PCBA.ModifiedBy,  
   PCBA.ModifiedDate,  
     TopUpInTime_1,TopUpOutTime_1, TopUpReason_1,TopUpInTime_2,TopUpOutTime_2, TopUpReason_2,TopUpInTime_3,   
     TopUpOutTime_3,   
     TopUpReason_3, TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5, TopUpOutTime_5,   
     TopUpReason_5,TopUpInTime_6,   
     TopUpOutTime_6, TopUpReason_6  
     FROM PR.VNM_NSA PCBA WITH(NOLOCK)   
     INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID  
     and CM.RowStatus = 1  
      LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
   on AD.Associate_ID = PCBA.AssociateID   
     WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
END  
END  
END  
  
if(@REPORTID=18)  
BEGIN  
if(@ROLEID not in (6,10))  
BEGIN  
--CIS NSA  
if(@COMPONENTID in (6))  
BEGIN  
    SELECT PCBA.PK_CISNSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
 ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
 ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
 Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID,TotalEligibleHours TotalMinutes,ExceptionReason,  
 PCBA.CreatedBy,PCBA.CreatedDate,PCBA.ModifiedBy,PCBA.ModifiedDate,  
 TopUpInTime_1, TopUpOutTime_1, TopUpReason_1,TopUpInTime_2,TopUpOutTime_2,TopUpReason_2,TopUpInTime_3,  
 TopUpOutTime_3,TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4,TopUpInTime_5,TopUpOutTime_5,  
 TopUpReason_5,TopUpInTime_6,TopUpOutTime_6,TopUpReason_6  
 FROM EXP.CIS_NSA PCBA WITH(NOLOCK)  
 INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID and CM.RowStatus = 1  
 LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
 on AD.Associate_ID = PCBA.AssociateID   
 WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
 and PCBA.CreatedBy <> 000000  
 and PCBA.Fk_ComponentID=6  
END  
  
--BPS NSA  
else if(@ComponentGrpID in (10))    
BEGIN    
 SELECT PCBA.PK_BPS_NSAID UniqueID, CM.ComponentName ,PCBA.AssociateID,  
 ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
 ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
 Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID,TotalEligibleHours TotalMinutes,ExceptionReason,  
 PCBA.CreatedBy,  
 PCBA.CreatedDate,PCBA.ModifiedBy,PCBA.ModifiedDate,  
 TopUpInTime_1, TopUpOutTime_1, TopUpReason_1, TopUpInTime_2, TopUpOutTime_2,TopUpReason_2,TopUpInTime_3,  
 TopUpOutTime_3,   
 TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5, TopUpOutTime_5,TopUpReason_5,  
 TopUpInTime_6,TopUpOutTime_6, TopUpReason_6  
 FROM EXP.BPS_NSA PCBA WITH(NOLOCK)   
 INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID and CM.RowStatus = 1  
 LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
 on AD.Associate_ID = PCBA.AssociateID   
 WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
 and PCBA.CreatedBy <> 000000 and  
 PCBA.Fk_ComponentID=39  
END  
  
--ADM NSA  
else if(@COMPONENTID in (172))  
BEGIN  
           SELECT PCBA.PK_ADMNSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
     ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
     ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
     Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID,TotalEligibleHours TotalMinutes,  
     ExceptionReason,PCBA.CreatedBy,  
     PCBA.CreatedDate,PCBA.ModifiedBy,PCBA.ModifiedDate,  
     TopUpInTime_1, TopUpOutTime_1, TopUpReason_1,TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,   
     TopUpInTime_3,   
     TopUpOutTime_3, TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5,  
     TopUpOutTime_5, TopUpReason_5,TopUpInTime_6, TopUpOutTime_6, TopUpReason_6  
     FROM EXP.ADM_NSA PCBA WITH(NOLOCK)  
     INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID  
     and CM.RowStatus = 1  
     LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
     on AD.Associate_ID = PCBA.AssociateID   
     WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
     and PCBA.CreatedBy <> 000000  
     and PCBA.Fk_ComponentID=172  
END  
---VNM NSA  
else if(@COMPONENTID =175)  
BEGIN  
    SELECT PCBA.PK_VNMNSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
 ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
 ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
 Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID,TotalEligibleHours TotalMinutes,ExceptionReason,  
 PCBA.CreatedBy,PCBA.CreatedDate,PCBA.ModifiedBy,PCBA.ModifiedDate,TopUpInTime_1,   
 TopUpOutTime_1, TopUpReason_1,TopUpInTime_2, TopUpOutTime_2,   
 TopUpReason_2,TopUpInTime_3, TopUpOutTime_3, TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4,   
 TopUpInTime_5,TopUpOutTime_5, TopUpReason_5,TopUpInTime_6, TopUpOutTime_6, TopUpReason_6  
 FROM EXP.VNM_NSA PCBA WITH(NOLOCK)  
 INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID and CM.RowStatus = 1  
 LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
 on AD.Associate_ID = PCBA.AssociateID   
 WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
 and PCBA.CreatedBy <> 000000  
END  
  
--IT 6th Day Allowance  
else if(@COMPONENTID =52)  
BEGIN  
    SELECT PCBA.PK_ITNSAID UniqueID,CM.ComponentName,PCBA.AssociateID,  
 ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '+  
 ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
 Date, HCMSchedule ,SwipeInTime, SwipeOutTime, ProjectID,TotalEligibleHours TotalMinutes,ExceptionReason,  
 PCBA.CreatedBy,  
 PCBA.CreatedDate,PCBA.ModifiedBy,PCBA.ModifiedDate,  
 TopUpInTime_1, TopUpOutTime_1, TopUpReason_1,TopUpInTime_2, TopUpOutTime_2, TopUpReason_2,TopUpInTime_3,  
 TopUpOutTime_3,TopUpReason_3,TopUpInTime_4, TopUpOutTime_4, TopUpReason_4, TopUpInTime_5, TopUpOutTime_5,   
 TopUpReason_5,TopUpInTime_6,TopUpOutTime_6, TopUpReason_6  
 FROM EXP.IT_NSA PCBA WITH(NOLOCK)  
 INNER JOIN dbo.ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentId = PCBA.Fk_ComponentID and CM.RowStatus = 1  
 LEFT OUTER JOIN CentralRepository.dbo.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
 on AD.Associate_ID = PCBA.AssociateID   
 WHERE PCBA.RowStatus = 1 and (Month(PCBA.CreatedDate) = @MONTH AND YEAR(PCBA.CreatedDate) = @YEAR)  
 and PCBA.CreatedBy <> 000000 and PCBA.Fk_ComponentID=52  
END  
END  
END  

  
