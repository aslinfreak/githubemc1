 IF(@ComponentGrpID=10 and @componentid=0)      
BEGIN  
 --Project Manager  
 IF(@RoleID =6)  
 BEGIN  
 --------------Insert data--------------------  
  INSERT INTO @Project(ProjectID)  
  Select P.Project_ID FROM CentralRepository.DBO.VW_Centralrepository_Project P WITH (NOLOCK)   
  INNER JOIN Approval_MonthlyYearlyApprovals AMA WITH (NOLOCK) ON P.Project_ID=AMA.ProjectID  
  INNER JOIN Centralrepository.dbo.vw_centralrepository_ProjectManager CRP WITH (NOLOCK)   
  ON CRP.Project_Manager=@LoginID  
  WHERE AMA.VerificationStatus=2  AND AMA.Rowstatus=1  and AMA.Fk_ComponentId in (39,101)  
   
  SELECT DISTINCT PCBA.ShiftType,PCBA.AssociateID,  
  ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
  +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
  convert(varchar,StartDate,101) StartDate,Convert(varchar,EndDate,101) EndDate,  
  PCBA.ProjectID,Amount,Grade,SetID,  
  Case when isnull(PCBA.Modifieddate,'')<>'' then convert(varchar,PCBA.Modifieddate,107)  
  else Convert(varchar,PCBA.Createddate,107) end UploadedDate,
  (CASE WHEN PCBA.Status IN (8) THEN 'Rejected by PFSS admin'
   ELSE CONVERT(VARCHAR,PCBA.ModifiedBy) END) AS RejectedBy,
  CASE WHEN  PCBA.Rowstatus=0 THEN 'Deleted' ELSE isnull(MC_A.Cdescription,'') END Status ,  
  PCBA.MonthAmount,PCBA.MonthlyWorkedDays  
  FROM PR.BPSNSA PCBA WITH (NOLOCK)  
  INNER JOIN @Project C ON PCBA.ProjectID=C.ProjectID  
  LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
  ON AD.Associate_ID=CONVERT(CHAR,PCBA.AssociateID)  
  LEFT OUTER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId   
  and MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
  WHERE ((PCBA.Status IN (3,8,17,18) AND PCBA.RowStatus=1) OR (PCBA.Rowstatus=0))   
  AND ((month(PCBA.CreatedDate)=@month AND year(PCBA.CreatedDate)=@year) OR  
  (month(PCBA.ModifiedDate)=@month AND year(PCBA.ModifiedDate)=@year))  
  
  END  
  
  /*check RoleId is 10*/  
  ELSE IF(@RoleID=10)  
  BEGIN  
  
  Select @CustomerID=Customer_ID FROM   
  CentralRepository.DBO.VW_Centralrepository_Project P WITH (NOLOCK)   
  INNER JOIN UserRoleMapping URM WITH (NOLOCK) ON P.Customer_ID=URM.CustomerID   
  and URM.AssociateID=@LoginID  
  INNER JOIN ComponentRoleMapping CRM WITH (NOLOCK)   
  on URM.Fk_ComponentRoleID=CRM.PK_ComponentRoleID and CRM.FK_RoleID=10  
  INNER JOIN ComponentCOuntryMapping CCM WITH (NOLOCK)   
  ON CCM.PK_ComponentCountryMappingID=CRM.FK_ComponentCountryMappingID  
  INNER JOIN ComponentMaster CM WITH (NOLOCK)   
  ON CM.PK_COmponentID=CCM.FK_ComponentID  
  WHERE  URM.AssociateID=@LoginID and URM.RowStatus=1 and CRM.RowStatus=1   
  and CM.FK_ComponentGroupID=10 and CCM.FK_ComponentCountryID=1  
  and CM.RowStatus=1 and CCM.Rowstatus=1  
  --------------Inserting data--------------------  
  INSERT INTO @Customer(CustomerID,ProjectID)  
  Select P.Customer_ID,P.Project_ID   
  FROM CentralRepository.DBO.VW_Centralrepository_Project P WITH (NOLOCK)   
  INNER JOIN Approval_MonthlyYearlyApprovals AMA WITH (NOLOCK)   
  ON CONVERT(VARCHAR,P.Project_ID)=AMA.ProjectID  
  WHERE AMA.VerificationStatus=2 AND P.Customer_ID=@CustomerID   
  AND AMA.Rowstatus=1   and AMA.Fk_ComponentId in (39,101)  
  
    SELECT DISTINCT PCBA.ShiftType,PCBA.AssociateID,  
    ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    convert(varchar,StartDate,101) StartDate,Convert(varchar,EndDate,101) EndDate,  
    C.ProjectID,Amount,Grade,SetID,  
    isnull(PCBA.CreatedBy, '' )  CreatedBy,  
    Case when isnull(PCBA.Modifieddate,'')<>'' then convert(varchar,PCBA.Modifieddate,107)  
    else Convert(varchar,PCBA.Createddate,107) end UploadedDate,  
    CASE WHEN  PCBA.Rowstatus=0 THEN 'Deleted' ELSE isnull(MC_A.Cdescription,'') END Status,   
    PCBA.MonthAmount,PCBA.MonthlyWorkedDays  
    FROM PR.BPSNSA PCBA WITH (NOLOCK)  
    INNER JOIN @Customer C ON PCBA.ProjectID=C.ProjectID  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
    ON AD.Associate_ID=CONVERT(CHAR,PCBA.AssociateID)  
    LEFT OUTER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId   
    and MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
    WHERE ((PCBA.Status IN (3,8,17,18) AND PCBA.RowStatus=1) OR (PCBA.Rowstatus=0))   
    AND (month(PCBA.CreatedDate)=@month) AND year(PCBA.CreatedDate)=@year   
  
  END  
    /*RoleID is 5*/  
  ELSE IF(@RoleID=5)  
   BEGIN  
   --Select Associate dtls  
    SELECT DISTINCT PCBA.ShiftType,PCBA.AssociateID,  
    ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    convert(varchar,StartDate,101) StartDate,Convert(varchar,EndDate,101) EndDate,  
    ProjectID,Amount,Grade,SetID,isnull(PCBA.CreatedBy, '' )  CreatedBy,  
    PCBA.CreatedDate as UploadedDate,(CASE WHEN PCBA.Status IN (8) THEN 'Rejected by PFSS admin'
	 ELSE CONVERT(VARCHAR,PCBA.ModifiedBy) END) AS RejectedBy,  
    PCBA.ModifiedDate as 'Rejected\Deleteddate',  
    CASE WHEN  PCBA.Rowstatus=0 THEN 'Deleted' ELSE isnull(MC_A.Cdescription,'') END Status ,  
    PCBA.MonthAmount,PCBA.MonthlyWorkedDays  
    FROM PR.BPSNSA PCBA WITH (NOLOCK)  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
    ON AD.Associate_ID=CONVERT(CHAR,PCBA.AssociateID)  
    LEFT OUTER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId   
    and MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
    WHERE ((PCBA.Status IN (3,8,17,18) AND PCBA.RowStatus=1) OR (PCBA.Rowstatus=0))   
    AND ((month(PCBA.CreatedDate)=@month AND year(PCBA.CreatedDate)=@year) OR  
    (month(PCBA.ModifiedDate)=@month AND year(PCBA.ModifiedDate)=@year))    
   END  
  /*RoleID is 11*/  
  ELSE IF(@RoleID=11)  
  BEGIN  
  insert into @Project(ProjectID)  
  Select URM.ProjectID from Approval_MonthlyYearlyApprovals MYA WITH (NOLOCK)          
  INNER JOIN UserRoleMapping URM WITH (NOLOCK) ON URM.ProjectID=MYA.ProjectID   
  INNER JOIN ComponentRoleMapping CRM WITH (NOLOCK) ON   
  URM.Fk_ComponentRoleID=CRM.PK_ComponentRoleID and CRM.FK_RoleID=11  
  INNER JOIN ComponentCOuntryMapping CCM WITH (NOLOCK)   
  ON CCM.PK_ComponentCountryMappingID=CRM.FK_ComponentCountryMappingID  
  INNER JOIN ComponentMaster CM WITH (NOLOCK) ON CM.PK_COmponentID=CCM.FK_ComponentID  
  WHERE  URM.AssociateID=@LoginID and URM.RowStatus=1 and CRM.RowStatus=1  and   
  CCM.FK_ComponentCountryID=1 and MYA.Rowstatus=1 and MYA.Fk_ComponentID=39  
  and CM.RowStatus=1 and CCM.Rowstatus=1  
  --------------Insert data--------------------  
  --INSERT INTO @Uploader(CustomerID,ProjectID)  
  --SELECT P.Customer_ID,P.Project_ID  
  --FROM CentralRepository.DBO.VW_Centralrepository_Project P WITH (NOLOCK)   
  --INNER JOIN Approval_MonthlyYearlyApprovals AMA WITH (NOLOCK)   
  --ON CONVERT(VARCHAR,P.Project_ID)=AMA.ProjectID  
  --WHERE AMA.VerificationStatus=2 AND P.Customer_ID=@CustomerID AND AMA.Rowstatus=1   
  --and AMA.Fk_ComponentId=@componentID  
  
    SELECT DISTINCT PCBA.ShiftType,PCBA.AssociateID,  
    ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    convert(varchar,StartDate,101) StartDate,Convert(varchar,EndDate,101) EndDate,  
    C.ProjectID,Amount,Grade,SetID,  
    isnull(PCBA.CreatedBy, '' )  CreatedBy,  
    Case when isnull(PCBA.Modifieddate,'')<>'' then convert(varchar,PCBA.Modifieddate,107)   
    else Convert(varchar,PCBA.Createddate,107) end UploadedDate,
	(CASE WHEN PCBA.Status IN (8) THEN 'Rejected by PFSS admin'
	 ELSE CONVERT(VARCHAR,PCBA.ModifiedBy) END) AS RejectedBy,
    CASE WHEN  PCBA.Rowstatus=0 THEN 'Deleted' ELSE isnull(MC_A.Cdescription,'') END Status ,   
    PCBA.MonthAmount,PCBA.MonthlyWorkedDays  
    FROM PR.BPSNSA PCBA WITH (NOLOCK)  
    INNER JOIN @Project C ON PCBA.ProjectID=C.ProjectID  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
    ON AD.Associate_ID=CONVERT(CHAR,PCBA.AssociateID)  
    LEFT OUTER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId  
    and MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
    WHERE ((PCBA.Status IN (3,8,17,18) AND PCBA.RowStatus=1) OR (PCBA.Rowstatus=0))   
    AND ((month(PCBA.CreatedDate)=@month AND year(PCBA.CreatedDate)=@year) OR  
    (month(PCBA.ModifiedDate)=@month AND year(PCBA.ModifiedDate)=@year)) AND PCBA.CreatedBy=@LoginID  
   END  
   ELSE  
   BEGIN  
   --Select Associate details  
    SELECT DISTINCT PCBA.ShiftType,PCBA.AssociateID,  
    ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    convert(varchar,StartDate,101) StartDate,Convert(varchar,EndDate,101) EndDate,  
    Convert(varchar(5),StartTime) StartTime,Convert(Varchar(5),EndTime) EndTime,ProjectID,  
    Amount,Grade,SetID,isnull(PCBA.CreatedBy, '' )  CreatedBy,  
    PCBA.CreatedDate as UploadedDate,(CASE WHEN PCBA.Status IN (8,3) THEN 'Rejected by PFSS admin'
	ELSE CONVERT(VARCHAR,PCBA.ModifiedBy) END) AS RejectedBy,   
    isnull(PCBA.RejectionReason,'') as RejectionReason,  
    PCBA.ModifiedDate as 'Rejected\Deleteddate',  
    CASE WHEN  PCBA.Rowstatus=0 THEN 'Deleted' ELSE isnull(MC_A.Cdescription,'') END Status ,  
    PCBA.MonthAmount,PCBA.MonthlyWorkedDays  
    FROM PR.BPSNSA PCBA WITH (NOLOCK)  
    INNER JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)  
    ON AD.Associate_ID=CONVERT(CHAR,PCBA.AssociateID)  
    INNER JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId   
    and MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
    WHERE ((PCBA.Status IN (3,8,17,18) AND PCBA.RowStatus=1) OR (PCBA.Rowstatus=0))   
    AND ((month(PCBA.CreatedDate)=@month AND year(PCBA.CreatedDate)=@year) OR  
    (month(PCBA.ModifiedDate)=@month AND year(PCBA.ModifiedDate)=@year))    
   END 
