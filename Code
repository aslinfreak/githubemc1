ALTER PROCEDURE [dbo].[usp_StagingToMain_BPSSDA] (@FileUploadID VARCHAR(50))
AS
BEGIN TRANSACTION
SET NOCOUNT ON  
BEGIN TRY 
BEGIN 
DECLARE @ComponentCountryMappingID int

 DECLARE @6DAENDDate date =(SELECT Cast(KeyValue AS DATE) FROM SPaykeys 
WHERE FK_ComponentID=36 AND KeyCode='6DA'AND KeyDescription='End Date for BPS 6DA')

Select @ComponentCountrymappingID = Pk_ComponentCountryMappingID from ComponentCountryMapping CCM With (nolock)
INNER JOIN ComponentMaster CM WITH(NOLOCK) ON CM.PK_ComponentID=CCM.FK_ComponentID
INNER JOIN ComponentGroupMaster STP WITH (NOLOCK) ON  CM.RowStatus=1 AND CM.FK_ComponentGroupID = 7
where CCM.Fk_ComponentCountryID=1 and CCM.Rowstatus=1  

declare @HCMStartDate date,
	@EffectiveDate date -- V1.0

		-- Start v1.0
		select @EffectiveDate =KeyValue 
		from dbo.SPaykeys where FK_ComponentID in (36) and KeyCode='6DAEffective'
		-- End v1.0

        UPDATE ESTP SET Rowstatus=0 FROM EXP.BPSSDA ESTP WITH (NOLOCK) INNER JOIN STG.BPSSDA STP WITH (NOLOCK) ON 
		ESTP.AssociateID=STP.AssociateID 
        WHERE STP.ShiftType=ESTP.ShiftType AND Convert(VARCHAR,ESTP.Startdate)=Convert(VARCHAR,STP.Startdate) and 
		STP.Rowstatus=1 AND ESTP.RowStatus=1
