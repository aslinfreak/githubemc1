 SELECT DISTINCT PCBA.AssociateID,  
   ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
   +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
 OfficeType,TravelType,StartDate,EndDate,StartTime,EndTime,ProjectID,Amount,Grade,SetID  
   ,isnull(PCBA.CreatedBy, '' )  CreatedBy,PCBA.CreatedDate as UploadedDate,PCBA.RejectionReason,  
   (CASE WHEN PCBA.Status in (8,3) THEN  'Rejected by PFSS admin'
	ELSE CONVERT(VARCHAR,PCBA.ModifiedBy) END) AS RejectedBy, PCBA.ModifiedDate as 'Rejected\Deleteddate',  
   CASE WHEN  PCBA.Rowstatus=0 THEN 'Deleted' ELSE isnull(MC_A.Cdescription,'') END Status ,  
   PCBA.City  
   FROM PR.BPSTRansportAllowance PCBA WITH (NOLOCK)  
   Inner JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
   ON CONVERT(VARCHAR,AD.Associate_ID)=CONVERT(VARCHAR,PCBA.AssociateID)  
   Inner JOIN MasterCodes MC_A WITH(NOLOCK) on MC_A.CParentRef=3 and PCBA.Status=MC_A.CCodeId   
   and MC_A.RowStatus=1 and MC_A.Cuserdefined1='PR'  
   WHERE ((PCBA.Status IN (3,8,17,18) AND PCBA.RowStatus=1) OR (PCBA.Rowstatus=0))   
   AND ((month(PCBA.CreatedDate)=@month AND year(PCBA.CreatedDate)=@year) OR  
   (month(PCBA.ModifiedDate)=@month AND year(PCBA.ModifiedDate)=@year))  
   END  
END   
