--------BASIC VALIDATIONS -----------------------------------------
          
          SELECT DISTINCT STP.Pk_BPSSDAID,ShiftType,STP.AssociateID,STP.StartDate,EndDate,StartTime,EndTime,
		  ProjectID, TransportEligibility, BillingDetails,STT.Grade,STT.BU SetID,STT.Location,AD.Isactive,
		  STT.EmplStatus, COALESCE((CASE WHEN AD.IsActive = 'T' and (DATEDIFF(DD,AD.EffDt ,GETDATE()) > 60)  
		  THEN 'Associate’s termination date is greater than 60 days. Special pay can’t be processed,'
		  ELSE NULL END), '')             
          +
		  COALESCE((CASE WHEN STT.EmplStatus <> 'A' and STT.EmplStatus = 'T' and 
		  (DATEDIFF(DD,STT.EFFDT,CONVERT(DATE,STP.Startdate)) > 0)
		  THEN 'AssociateID is InActive' ELSE NULL END), '') 
	      +
          COALESCE((CASE WHEN (AD.COMPANY IS NULL AND LEN(STP.AssociateID) in (6,7)) 
            THEN 'Associate''s Company is Unavailable,' ELSE NULL END), '')  
          +
          COALESCE((CASE WHEN (AD.BUSINESS_UNIT IS NULL AND LEN(STP.AssociateID) in (6,7)) 
                         THEN 'Associate SetId is Unavailable,' ELSE NULL END), '')    
          +
          COALESCE((CASE WHEN ISDATE(STP.Startdate)=1 AND 
          (CONVERT(DATE,STP.StartDate)<=CONVERT(DATE,(DATEADD(M,-6,CONVERT(DATE,CONVERT(VARCHAR,YEAR(GETDATE()))+'-'
          +CONVERT(VARCHAR,MONTH(GETDATE()))+'-'+'16')))))  
          THEN 'Allowance claim date exceeds Six months,' ELSE NULL END), '')                                   
          +
          COALESCE((CASE WHEN  UPPER(STT.BU) NOT LIKE '%IND%'
          THEN 'Associate Should belong to India as on claim date,' ELSE NULL END), '')
          +
          COALESCE((CASE WHEN (STT.EmplType='EMP') THEN NULL ELSE 'Associate is a contractor,' END), '')
              
           AS ExceptionReason,
          STP.CreatedBy, STP.CreatedDate,STT.CITY ----v1.0
          INTO #BPSSDA 
          FROM STG.BPSSDA STP WITH(NOLOCK)      
          LEFT OUTER JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK) ON 
		  AD.Associate_ID=STP.AssociateID 
          LEFT OUTER JOIN #STTEMP STT WITH(NOLOCK) ON STT.AssociateID=STP.AssociateID
		  and convert(varchar,STP.startdate)=
		  convert(varchar,STT.startdate)
			WHERE STP.RowStatus=1  
      
          INSERT INTO EXP.BPSSDA(ShiftType, AssociateID, StartDate, EndDate, StartTime, EndTime, ProjectID,  
		  TRansportEligibility, BillingDetails, Grade, SetID, 
          ExceptionRemarks,CreatedBy,CreatedDate,RowStatus,StartDateTime,EndDateTime)

          SELECT ShiftType, AssociateID, StartDate, EndDate, StartTime, EndTime, 
           ProjectID,  TRansportEligibility, BillingDetails, Grade, SetID,ExceptionReason,CreatedBy,CreatedDate,1,
          CONVERT(DATETIME,(CONVERT(VARCHAR,Startdate)+' '+CONVERT(VARCHAR,Starttime))) AS StartDateTime,
          CONVERT(DATETIME,(CONVERT(VARCHAR,Enddate)+' '+CONVERT(VARCHAR,Endtime))) AS EndDateTime 
		  FROM #BPSSDA WITH (NOLOCK)
		  WHERE ISNULL(ExceptionReason,'')<>'' 
         
          DELETE FROM #BPSSDA WHERE ExceptionReason<>''
