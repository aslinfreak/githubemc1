IF(@componentid in (50,51,52))  
 BEGIN  
      IF(@Componentid=52 and @RoleID in (6,5)) --IT NSA  
   BEGIN  
    CREATE TABLE #ITCOMPONENTSP (ComponentID INT,ProjectID VARCHAR(50))  
             
    INSERT INTO #ITCOMPONENTSP (ComponentID ,ProjectID )     
    EXEC [dbo].[usp_GetComponentsForRole] @RoleID,@LoginID,@ComponentGrpID    
  
    SELECT DISTINCT PSTP.AssociateID,ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    PSTP.ProjectID,CM.ComponentName AS AllowanceType,STM.SHIFTTYPENAME AS ShiftType,  
    CONVERT(VARCHAR,PSTP.StartDate,101) AS StartDate,  
    CONVERT(VARCHAR,PSTP.EndDate,101) AS EndDate,  
    PSTP.TransportEligibility AS TransportEligibility,PSTP.Amount,  
    ISNULL(PSTP.REJECTIONREASON,'') AS RejectReason,  
    --(CASE WHEN PSTP.Status=3 AND PSTP.RowStatus=1 THEN 'Rejected' WHEN PSTP.RowStatus=0   
    -- THEN 'Deleted' END)   
    (CASE WHEN PSTP.Status=3 AND PSTP.RowStatus=1 THEN 'Rejected'   
    when Status=23 and PSTP.RowStatus=1 then 'Rejected by Home Manager'   
    when Status=17 and PSTP.RowStatus=1 then 'Rejected by Project Manager'   
    when Status=36 and PSTP.RowStatus=1 then 'Rejected by D+'  
    WHEN PSTP.RowStatus=0 THEN 'Deleted' END)   
    AS Status,   
    ISNULL(PSTP.InputRemarks,'') AS Remarks,PSTP.Createdby UploadedBy,  
          ISNULL(LTRIM(RTRIM(UD.Associate_FirstName)),'')+' '  
          +ISNULL(LTRIM(RTRIM(UD.Associate_LastName)),'') AS UploaderName,  
                PSTP.CreatedDate UploadedDate,(CASE WHEN PSTP.FK_RejectedRoleID = 3 THEN 'Rejected by PFSS admin'
	ELSE CONVERT(VARCHAR,PSTP.ModifiedBy) END) AS RejectedBy,PSTP.ModifiedDate 'Rejected\Deleteddate',  
          PSTP.NSADate AS ShiftStartDate  
    FROM PR.ITSHIFTALLOWANCE PSTP WITH(NOLOCK)  
    LEFT OUTER JOIN COMPONENTMASTER CM WITH(NOLOCK)   
    ON CM.PK_COMPONENTID=PSTP.FK_COMPONENTID AND CM.ROWSTATUS=1  
    LEFT OUTER JOIN SHIFTTYPEMASTER STM WITH(NOLOCK)   
    ON STM.PK_SHIFTTYPEID=PSTP.FK_SHIFTTYPEID AND STM.RowStatus=1  
    LEFT OUTER JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
    ON AD.Associate_ID=CONVERT(CHAR,PSTP.AssociateID)  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details UD WITH(NOLOCK)   
    ON UD.Associate_ID=CONVERT(CHAR,PSTP.CreatedBy)   
    INNER JOIN #ITCOMPONENTSP CMTS WITH(NOLOCK) ON  CMTS.ComponentID=PSTP.Fk_ComponentID   
    AND CMTS.ProjectID=PSTP.ProjectID AND CMTS.ComponentID = @componentid  
    --WHERE (PSTP.STATUS=3 OR PSTP.RowStatus=0)   
    WHERE (PSTP.STATUS in (3,23,36,17) OR PSTP.RowStatus=0)   
    AND ((DATEPART(MM,PSTP.CreatedDate)=@Month AND DATEPART(YY,PSTP.CreatedDate)=@Year) OR   
    (DATEPART(MM,PSTP.ModifiedDate)=@Month AND DATEPART(YY,PSTP.ModifiedDate)=@Year))  
    AND CM.PK_componentid=@componentid  
      
    --Drops the temp table  
    DROP TABLE  #ITCOMPONENTSP   
  END   
   ELSE IF(@Componentid not in (52) and @RoleID=6)  
    BEGIN  
    CREATE TABLE #ITCOMPONENTS (ComponentID INT,ProjectID VARCHAR(50))  
            --Insert into temp table  
    INSERT INTO #ITCOMPONENTS (ComponentID ,ProjectID )     
    EXEC [dbo].[usp_GetComponentsForRole] @RoleID,@LoginID,@ComponentGrpID    
  
    SELECT DISTINCT PSTP.AssociateID,ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    PSTP.ProjectID,CM.ComponentName AS AllowanceType,STM.SHIFTTYPENAME AS ShiftType,  
    CONVERT(VARCHAR,PSTP.StartDate,101) AS StartDate,  
    CONVERT(VARCHAR(5),PSTP.StartTime,108) AS StartTime,  
    CONVERT(VARCHAR(5),PSTP.EndTime,108) AS EndTime,CONVERT(VARCHAR,PSTP.EndDate,101) AS EndDate,  
    ISNULL(PSTP.HCMSchedule,'') AS HCMShift,  
    PSTP.TransportEligibility AS TransportEligibility,PSTP.Amount,  
    ISNULL(PSTP.REJECTIONREASON,'') AS RejectReason,  
    --(CASE WHEN PSTP.Status=3 AND PSTP.RowStatus=1 THEN 'Rejected' WHEN PSTP.RowStatus=0   
    -- THEN 'Deleted' END)   
    (CASE WHEN PSTP.Status=3 AND PSTP.RowStatus=1 THEN 'Rejected'   
    when Status=23 and PSTP.RowStatus=1 then 'Rejected by Home Manager'   
    when Status=17 and PSTP.RowStatus=1 then 'Rejected by Project Manager'   
    when Status=36 and PSTP.RowStatus=1 then 'Rejected by D+'  
    WHEN PSTP.RowStatus=0 THEN 'Deleted' END)   
    AS Status,   
    ISNULL(PSTP.InputRemarks,'') AS Remarks,PSTP.Createdby UploadedBy,  
          ISNULL(LTRIM(RTRIM(UD.Associate_FirstName)),'')+' '  
          +ISNULL(LTRIM(RTRIM(UD.Associate_LastName)),'') AS UploaderName,  
                PSTP.CreatedDate UploadedDate,(CASE WHEN PSTP.FK_RejectedRoleID = 3 THEN 'Rejected by PFSS admin'
	ELSE CONVERT(VARCHAR,PSTP.ModifiedBy) END) AS RejectedBy,PSTP.ModifiedDate 'Rejected\Deleteddate',  
          PSTP.NSADate AS ShiftStartDate  
    FROM PR.ITSHIFTALLOWANCE PSTP WITH(NOLOCK)  
    LEFT OUTER JOIN COMPONENTMASTER CM WITH(NOLOCK)   
    ON CM.PK_COMPONENTID=PSTP.FK_COMPONENTID AND CM.ROWSTATUS=1  
    LEFT OUTER JOIN SHIFTTYPEMASTER STM WITH(NOLOCK)   
    ON STM.PK_SHIFTTYPEID=PSTP.FK_SHIFTTYPEID AND STM.RowStatus=1  
    LEFT OUTER JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
    ON AD.Associate_ID=CONVERT(CHAR,PSTP.AssociateID)  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details UD WITH(NOLOCK)   
    ON UD.Associate_ID=CONVERT(CHAR,PSTP.CreatedBy)   
    INNER JOIN #ITCOMPONENTS CMTS WITH(NOLOCK) ON  CMTS.ComponentID=PSTP.Fk_ComponentID   
    AND CMTS.ProjectID=PSTP.ProjectID AND CMTS.ComponentID = @componentid  
    --WHERE (PSTP.STATUS=3 OR PSTP.RowStatus=0)   
    WHERE (PSTP.STATUS in (3,23,36,17) OR PSTP.RowStatus=0)   
    AND ((DATEPART(MM,PSTP.CreatedDate)=@Month AND DATEPART(YY,PSTP.CreatedDate)=@Year) OR   
    (DATEPART(MM,PSTP.ModifiedDate)=@Month AND DATEPART(YY,PSTP.ModifiedDate)=@Year))  
    AND CM.PK_componentid=@componentid  
      
    --Drops the temp table  
    DROP TABLE  #ITCOMPONENTS   
  END   
   ELSE   
    BEGIN  
    IF(@RoleID=12)  
    BEGIN  
    SELECT DISTINCT PSTP.AssociateID,ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    PSTP.ProjectID,CM.ComponentName AS AllowanceType,STM.SHIFTTYPENAME AS ShiftType,  
    CONVERT(VARCHAR,PSTP.StartDate,101) AS StartDate,CONVERT(VARCHAR(5),PSTP.StartTime,108) AS StartTime,  
    CONVERT(VARCHAR(5),PSTP.EndTime,108) AS EndTime,CONVERT(VARCHAR,PSTP.EndDate,101) AS EndDate,  
    ISNULL(PSTP.HCMSchedule,'') AS HCMShift,  
       PSTP.TransportEligibility AS TransportEligibility,PSTP.Amount,  
    ISNULL(PSTP.REJECTIONREASON,'') AS RejectReason,  
    (CASE WHEN PSTP.Status=3 AND PSTP.RowStatus=1 THEN 'Rejected' WHEN PSTP.RowStatus=0 THEN 'Deleted'   
    when Status=23 and PSTP.RowStatus=1 then 'Rejected by Home Manager'   
    when Status=17 and PSTP.RowStatus=1 then 'Rejected by Project Manager'   
    when Status=36 and PSTP.RowStatus=1 then 'Rejected by D+' END) AS Status,   
    ISNULL(PSTP.InputRemarks,'') AS Remarks,PSTP.Createdby UploadedBy,  
    ISNULL(LTRIM(RTRIM(UD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(UD.Associate_LastName)),'') AS UploaderName,  
    PSTP.CreatedDate UploadedDate,(CASE WHEN PSTP.FK_RejectedRoleID = 3 THEN 'Rejected by PFSS admin'
	ELSE CONVERT(VARCHAR,PSTP.ModifiedBy) END) AS RejectedBy,  
    PSTP.ModifiedDate 'Rejected\Deleteddate',PSTP.NSADate AS ShiftStartDate  
    FROM PR.ITSHIFTALLOWANCE PSTP WITH(NOLOCK)  
    LEFT OUTER JOIN COMPONENTMASTER CM WITH(NOLOCK)   
    ON CM.PK_COMPONENTID=PSTP.FK_COMPONENTID AND CM.ROWSTATUS=1  
    LEFT OUTER JOIN SHIFTTYPEMASTER STM WITH(NOLOCK)  
    ON STM.PK_SHIFTTYPEID=PSTP.FK_SHIFTTYPEID AND STM.RowStatus=1  
    LEFT OUTER JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
    ON AD.Associate_ID=CONVERT(CHAR,PSTP.AssociateID)  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details UD WITH(NOLOCK)  
    ON UD.Associate_ID=CONVERT(CHAR,PSTP.CreatedBy)  
    WHERE (PSTP.STATUS in(3,17,23,36) OR PSTP.RowStatus=0)   
    AND ((DATEPART(MM,PSTP.CreatedDate)=@Month AND DATEPART(YY,PSTP.CreatedDate)=@Year) OR   
    (DATEPART(MM,PSTP.ModifiedDate)=@Month AND DATEPART(YY,PSTP.ModifiedDate)=@Year))   
    AND CM.PK_componentid=@componentid and PSTP.CreatedBy=@LoginID  
    END  
    ELSE IF(@componentid in (50,51) AND @RoleID in (2,3))  
    BEGIN  
    SELECT DISTINCT PSTP.AssociateID,ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    PSTP.ProjectID,CM.ComponentName AS AllowanceType,STM.SHIFTTYPENAME AS ShiftType,  
    CONVERT(VARCHAR,PSTP.StartDate,101) AS StartDate,CONVERT(VARCHAR(5),PSTP.StartTime,108) AS StartTime,  
    CONVERT(VARCHAR(5),PSTP.EndTime,108) AS EndTime,CONVERT(VARCHAR,PSTP.EndDate,101) AS EndDate,  
    ISNULL(PSTP.HCMSchedule,'') AS HCMShift,  
       PSTP.TransportEligibility AS TransportEligibility,  
    isnull(SDA_OCA_Amount,0) as SDA_OCA_Amount1,  
    isnull(SDA_OCA_Amount2,0) as SDA_OCA_Amount2,  
    PSTP.Amount as TotalAmount,  
    ISNULL(PSTP.REJECTIONREASON,'') AS RejectReason,  
    (CASE WHEN PSTP.Status=3 AND PSTP.RowStatus=1 THEN 'Rejected' WHEN PSTP.RowStatus=0 THEN 'Deleted'   
    when Status=23 and PSTP.RowStatus=1 then 'Rejected by Home Manager'   
    when Status=17 and PSTP.RowStatus=1 then 'Rejected by Project Manager'   
    when Status=36 and PSTP.RowStatus=1 then 'Rejected by D+' END) AS Status,   
    ISNULL(PSTP.InputRemarks,'') AS Remarks,PSTP.Createdby UploadedBy,  
    ISNULL(LTRIM(RTRIM(UD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(UD.Associate_LastName)),'') AS UploaderName,  
    PSTP.CreatedDate UploadedDate,(CASE WHEN PSTP.FK_RejectedRoleID = 3 THEN 'Rejected by PFSS admin'
	ELSE CONVERT(VARCHAR,PSTP.ModifiedBy) END) AS RejectedBy,  
    PSTP.ModifiedDate 'Rejected\Deleteddate',PSTP.NSADate AS ShiftStartDate  
    FROM PR.ITSHIFTALLOWANCE PSTP WITH(NOLOCK)  
    LEFT OUTER JOIN COMPONENTMASTER CM WITH(NOLOCK)   
    ON CM.PK_COMPONENTID=PSTP.FK_COMPONENTID AND CM.ROWSTATUS=1  
    LEFT OUTER JOIN SHIFTTYPEMASTER STM WITH(NOLOCK)  
    ON STM.PK_SHIFTTYPEID=PSTP.FK_SHIFTTYPEID AND STM.RowStatus=1  
    LEFT OUTER JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
    ON AD.Associate_ID=CONVERT(CHAR,PSTP.AssociateID)  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details UD WITH(NOLOCK)  
    ON UD.Associate_ID=CONVERT(CHAR,PSTP.CreatedBy)  
    WHERE (PSTP.STATUS in(3,17,23,36) OR PSTP.RowStatus=0)   
    AND ((DATEPART(MM,PSTP.CreatedDate)=@Month AND DATEPART(YY,PSTP.CreatedDate)=@Year) OR   
    (DATEPART(MM,PSTP.ModifiedDate)=@Month AND DATEPART(YY,PSTP.ModifiedDate)=@Year))   
    AND CM.PK_componentid=@componentid  
    END  
    ELSE  
    BEGIN  
    SELECT DISTINCT PSTP.AssociateID,ISNULL(LTRIM(RTRIM(AD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(AD.Associate_LastName)),'') AS AssociateName,  
    PSTP.ProjectID,CM.ComponentName AS AllowanceType,STM.SHIFTTYPENAME AS ShiftType,  
    CONVERT(VARCHAR,PSTP.StartDate,101) AS StartDate,CONVERT(VARCHAR(5),PSTP.StartTime,108) AS StartTime,  
    CONVERT(VARCHAR(5),PSTP.EndTime,108) AS EndTime,CONVERT(VARCHAR,PSTP.EndDate,101) AS EndDate,  
    ISNULL(PSTP.HCMSchedule,'') AS HCMShift,  
       PSTP.TransportEligibility AS TransportEligibility,PSTP.Amount,  
    ISNULL(PSTP.REJECTIONREASON,'') AS RejectReason,  
    (CASE WHEN PSTP.Status=3 AND PSTP.RowStatus=1 THEN 'Rejected' WHEN PSTP.RowStatus=0 THEN 'Deleted'   
    when Status=23 and PSTP.RowStatus=1 then 'Rejected by Home Manager'   
    when Status=17 and PSTP.RowStatus=1 then 'Rejected by Project Manager'   
    when Status=36 and PSTP.RowStatus=1 then 'Rejected by D+' END) AS Status,   
    ISNULL(PSTP.InputRemarks,'') AS Remarks,PSTP.Createdby UploadedBy,  
    ISNULL(LTRIM(RTRIM(UD.Associate_FirstName)),'')+' '  
    +ISNULL(LTRIM(RTRIM(UD.Associate_LastName)),'') AS UploaderName,  
    PSTP.CreatedDate UploadedDate,(CASE WHEN PSTP.FK_RejectedRoleID = 3 THEN 'Rejected by PFSS admin'
	ELSE CONVERT(VARCHAR,PSTP.ModifiedBy) END) AS RejectedBy,   
    PSTP.ModifiedDate 'Rejected\Deleteddate',PSTP.NSADate AS ShiftStartDate  
    FROM PR.ITSHIFTALLOWANCE PSTP WITH(NOLOCK)  
    LEFT OUTER JOIN COMPONENTMASTER CM WITH(NOLOCK)   
    ON CM.PK_COMPONENTID=PSTP.FK_COMPONENTID AND CM.ROWSTATUS=1  
    LEFT OUTER JOIN SHIFTTYPEMASTER STM WITH(NOLOCK)  
    ON STM.PK_SHIFTTYPEID=PSTP.FK_SHIFTTYPEID AND STM.RowStatus=1  
    LEFT OUTER JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details AD WITH(NOLOCK)   
    ON AD.Associate_ID=CONVERT(CHAR,PSTP.AssociateID)  
    LEFT OUTER  JOIN CENTRALREPOSITORY.DBO.vw_CentralRepository_Associate_Details UD WITH(NOLOCK)  
    ON UD.Associate_ID=CONVERT(CHAR,PSTP.CreatedBy )  
    WHERE (PSTP.STATUS in(3,17,23,36) OR PSTP.RowStatus=0)   
    AND ((DATEPART(MM,PSTP.CreatedDate)=@Month AND DATEPART(YY,PSTP.CreatedDate)=@Year) OR   
    (DATEPART(MM,PSTP.ModifiedDate)=@Month AND DATEPART(YY,PSTP.ModifiedDate)=@Year))   
    AND CM.PK_componentid=@componentid  
    END  
    END  
 END  
