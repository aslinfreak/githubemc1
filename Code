        [HttpPost]
        public ActionResult Book(AppointmentViewModel model)
        {
            DateTime selectedTime = model.AppointmentDateTime;
            DateTime startWindow = selectedTime.AddMinutes(-50);
            DateTime endWindow = selectedTime.AddMinutes(50);

            var conflict = db.Appointments.FirstOrDefault(a => a.DoctorID == model.DoctorId && 
            a.AppointmentDateTime >= startWindow && a.AppointmentDateTime <= endWindow);
            if (conflict != null)
            {
                ViewBag.Message = "Slot not available, please pick another time.";
                model.Doctors = db.Users.Where(u => u.Role == "Doctor").Select(d => new SelectListItem
                {
                    Value = d.UserID.ToString(),
                    Text = d.FullName
                }).ToList();
                return View(model);
            }
            var appointment = new Appointment
            {
                PatientID = Convert.ToInt32(Session["UserID"]),
                DoctorID = model.DoctorId,
                AppointmentDateTime = model.AppointmentDateTime,
                Reason = model.Reason,
                Status = "Pending"
            };

            db.Appointments.Add(appointment);
            db.SaveChanges();

            ViewBag.Message = "Appointment Booked Successfully!";
            return RedirectToAction("MyAppointments");
        }

        public ActionResult MyAppointments()
        {
            int patientId = Convert.ToInt32(Session["UserID"]);
            var appointments = db.Appointments.Where(a => a.PatientID == patientId)
                .ToList();
            return View(appointments);
        }
    }
}
